(function(){var $,e,n,t,l,u,i,o,r,c,d,a,s,f,h,p,v,g,m,w,b,z,_,k,F,S,q,x;$=jQuery,u="#jquery-fullsizable",c="#fullsized_image_holder",F="fullsized_spinner",e=$('<div id="jquery-fullsizable"><div id="fullsized_image_holder"></div></div>'),d=[],i=0,g=null,S=null,z=function(){var e;return e=d[i],null==e.ratio&&(e.ratio=(e.naturalHeight/e.naturalWidth).toFixed(2)),$(window).height()/e.ratio>$(window).width()?($(e).width($(window).width()),$(e).height($(window).width()*e.ratio),$(e).css("margin-top",($(window).height()-$(e).height())/2)):($(e).height($(window).height()),$(e).width($(window).height()/e.ratio),$(e).css("margin-top",0))},a=function(e){return 27===e.keyCode&&l(),37===e.keyCode&&b(!0),39===e.keyCode?p(!0):void 0},b=function(e){return null==e&&(e=!1),i>0?k(d[i-1],-1,e):void 0},p=function(e){return null==e&&(e=!1),i<d.length-1?k(d[i+1],1,e):void 0},k=function(e,n,t){return null==n&&(n=1),null==t&&(t=!1),i=e.index,$(c).hide(),$(c).html(e),g.navigation&&(t===!0?r():_()),null!=e.loaded?($(u).removeClass(F),z(),$(c).fadeIn("fast"),m(n)):($(u).addClass(F),e.onload=function(){return z(),$(c).fadeIn("slow",function(){return $(u).removeClass(F)}),this.loaded=!0,m(n)},e.src=e.buffer_src)},m=function(e){var n;if(1===e&&i<d.length-1)n=d[i+1];else{if(-1!==e&&i!==d.length-1||!(i>0))return;n=d[i-1]}return n.onload=function(){return this.loaded=!0},""===n.src?n.src=n.buffer_src:void 0},v=function(t,l){return $("body").append(e),$(window).bind("resize",z),k(t),$(u).hide().fadeIn(function(){return null!=g.detach_id&&(S=$(window).scrollTop(),$("#"+g.detach_id).css("display","none"),z()),n(),$(document).trigger("fullsizable:opened",l)})},l=function(){return null!=g.detach_id&&($("#"+g.detach_id).css("display","block"),$(window).scrollTop(S)),$(u).fadeOut(function(){return e.remove()}),t(),$(u).removeClass(F),x(),$(window).unbind("resize",z)},s=function(){return d.length=0,$(g.selector).each(function(){var e;return e=new Image,e.buffer_src=$(this).attr("href"),e.index=d.length,d.push(e),g.openOnClick?$(this).click(function(n){return n.preventDefault(),g.reloadOnOpen&&s(),v(e,this)}):void 0})},w=function(){switch(g.navigation&&(e.append('<a id="fullsized_go_prev" href="#prev"></a><a id="fullsized_go_next" href="#next"></a>'),$(document).on("click","#fullsized_go_prev",function(e){return e.preventDefault(),e.stopPropagation(),b()}),$(document).on("click","#fullsized_go_next",function(e){return e.preventDefault(),e.stopPropagation(),p()})),g.closeButton&&(e.append('<a id="fullsized_close" href="#close"></a>'),$(document).on("click","#fullsized_close",function(e){return e.preventDefault(),e.stopPropagation(),l()})),g.fullscreenButton&&o()&&(e.append('<a id="fullsized_fullscreen" href="#fullscreen"></a>'),$(document).on("click","#fullsized_fullscreen",function(e){return e.preventDefault(),e.stopPropagation(),q()})),g.clickBehaviour){case"close":return $(document).on("click",u,l);case"next":return $(document).on("click",u,function(){return p(!0)});default:return $(document).on("click",u,g.clickBehaviour)}},n=function(){return $(document).bind("keydown",a),$(document).bind("fullsizable:next",function(){return p(!0)}),$(document).bind("fullsizable:prev",function(){return b(!0)}),$(document).bind("fullsizable:close",l)},x=function(){return $(document).unbind("keydown",a),$(document).unbind("fullsizable:next"),$(document).unbind("fullsizable:prev"),$(document).unbind("fullsizable:close")},r=function(){var n;return n=e.find("a"),n.is(":visible")===!0?(n.toggle(!1),e.bind("mousemove",f)):void 0},h=null,f=function(n){var t;return null===h&&(h=[n.clientX,n.clientY]),t=Math.round(Math.sqrt(Math.pow(h[1]-n.clientY,2)+Math.pow(h[0]-n.clientX,2))),t>=10?(e.unbind("mousemove",f),h=null,_()):void 0},_=function(){return $("#fullsized_close, #fullsized_fullscreen").toggle(!0),$("#fullsized_go_prev").toggle(0!==i),$("#fullsized_go_next").toggle(i!==d.length-1)},$.fn.fullsizable=function(e){return g=$.extend({selector:this.selector,detach_id:null,navigation:!0,closeButton:!0,fullscreenButton:!0,openOnClick:!0,clickBehaviour:"close",preload:!0,reloadOnOpen:!1},e||{}),w(),g.preload&&s(),$(document).bind("fullsizable:reload",s),$(document).bind("fullsizable:open",function(e,n){var t,l,u,i;for(g.reloadOnOpen&&s(),i=[],l=0,u=d.length;u>l;l++)t=d[l],i.push(t.buffer_src===$(n).attr("href")?v(t,n):void 0);return i}),this},o=function(){var n;return n=e.get(0),n.requestFullScreen||n.webkitRequestFullScreen||n.mozRequestFullScreen?!0:!1},t=function(){return q(!0)},q=function(n){var t;return t=e.get(0),t.requestFullScreen?document.fullScreen||n?document.exitFullScreen():t.requestFullScreen():t.webkitRequestFullScreen?document.webkitIsFullScreen||n?document.webkitCancelFullScreen():t.webkitRequestFullScreen():t.mozRequestFullScreen?document.mozFullScreen||n?document.mozCancelFullScreen():t.mozRequestFullScreen():void 0}}).call(this);